import React from "react";
import { useUser } from "@auth0/nextjs-auth0";

import Card from "../Components/Card/index";
import Navbar from "../Components/Navbar/index.js";
import styles from "../styles/profile.module.css";
import Link from "next/link";
import Head from "next/head";
import Button from "../Components/Button";

function profile({ users, listings }) {

  const u = users;
    const { user, error, isLoading } = useUser();

    // console.log(u)
    // console.log(users.);
    
    if(isLoading) return <div>Loading ...</div>;
    if(error) return <div>{error.message}</div>;

    const regUser = u.find(regUser => regUser.email === user.email);

  // const particularUser = users.filter(parUser => parUser.email === user.email);


const { id,
  first_name,
  last_name,
  email,
  address,
  is_active,
  cloudinary_id,
  avatar,
  user_bio } = regUser;



  return (
    <div className="main-container">
      <Head>
        <title>iGive</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
        <style>
          @import
          url('https://fonts.googleapis.com/css2?family=Montserrat&display=swap');
        </style>
        <link
          rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
        ></link>
      </Head>
      <Navbar avatar={regUser.avatar}/>

      <div className={styles.form}>
        <form></form>
      </div>

      <div className={styles.flexboxContainer}>
        <div className={`${styles.flexItems} ${styles.flexItem1}`}>
        <img className={styles.userImg} src={regUser.avatar} />
          
          {/* <div className={styles.userImg}> */}
            {/* <Link href="/">
              <a>
                <img src="https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500" />
              </a>
            </Link> */}
          {/* </div> */}
          {/* <span className={`fa fa-camera ${styles.camera}`}></span>
          <div className={styles.stars}>
            <span className={`fa fa-star ${styles.checked}`}></span>
            <span className={`fa fa-star ${styles.checked}`}></span>
            <span className={`fa fa-star ${styles.checked}`}></span>
            <span className={`fa fa-star ${styles.checked}`}></span>
            <span class="fa fa-star"></span>
          </div> */}

        </div>
        <div className={`${styles.flexItems} ${styles.flexItem2}`}>
       
                
              
          <div className={styles.profileInfoBox}>
            <div className={styles.block1}>
              <p className={styles.profileTitle}>Name</p>
              <p className={styles.infoLine}>{first_name} {last_name}</p>
            </div>
            <div className={styles.block2}>
              <p className={styles.profileTitle}>Address</p>
              <p className={styles.infoLine}>{address}</p>
            </div>
            <div className={styles.block3}>
              <p className={styles.profileTitle}>Email</p>
              <p className={styles.infoLine}>{email}</p>
            </div>
            <div>
              <p className={styles.editBtn}>Edit</p>
              <p className={styles.editBtn}>Add</p>
            </div>
            
          </div>

        </div>
        <div className={`${styles.flexItems} ${styles.flexItem4}`}>
          <h4 className={styles.profileTitle}>Bio</h4>
          <p>{user_bio}</p>
        </div>
        <div className={styles.btnSection}>
          <button className={styles.giveBtn}>Give Item</button>
          <button className={styles.searchBtn}>Search Item</button>
        </div>
        <h2 className={styles.title}>My Listing</h2>
        
        {/*  */}
        <div className={`${styles.flexItems} ${styles.flexItem3}`}>
          {/* USER ID FOR FETCHING ITEMS */}
          {/* <Card userID={id} /> */}
          <Card />
          <Card />
          <Card />
          <Card />
          <Card />
          <Card />
          <Card />
          <Card />
        </div>
      </div>
    </div>
  );
}



//Fetching data to PROPS
// export async function getServerSideProps() {
    
//   const res = await fetch(`https://it-crowd-project.herokuapp.com/api/users`);
//   const data = await res.json();

//   // By returning { props: { allUsers } }, the PostAuth component
//   // will receive `allUsers` as a prop at BUILD time
//   return {
//       props: 
//           { users: data.payload },
//     }
  
// }


export const getServerSideProps = async () => {
   
  const usersRes = await fetch(`https://it-crowd-project.herokuapp.com/api/users`);
      const usersData = await usersRes.json();


  const listingsRes = await fetch(`https://it-crowd-project.herokuapp.com/api/listings`);
  const listingsData = await listingsRes.json();
  // By returning { props: { allUsers } }, the PostAuth component
  // will receive `allUsers` as a prop at BUILD time
  return {
      props: 
          { users: usersData.payload,
            listings: listingsData.payload },
  }
};


export default profile;


